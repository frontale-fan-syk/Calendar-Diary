<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã•ã‚„ã‹ã•ã‚“ã®ä¸‡å¹´æ—¥è¨˜å¸³</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #fdf6f0; color: #444; padding-bottom: 50px; }
        .calendar-header { display: flex; align-items: center; gap: 20px; margin: 20px 0; }
        .nav-btn { background: #d88a8a; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        h2 { color: #d88a8a; margin: 0; min-width: 150px; text-align: center; }
        
        #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; max-width: 400px; width: 95%; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .weekday { text-align: center; font-size: 12px; font-weight: bold; color: #999; padding-bottom: 5px; }
        .day { aspect-ratio: 1; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; transition: 0.2s; border: 1px solid #f0f0f0; background: #fff; position: relative; }
        .day:hover { background: #fff0f0; border-color: #d88a8a; }
        
        /* è‰²è¨­å®š */
        .sun, .holiday { color: #ff4d4d !important; background: #fff5f5; }
        .sat { color: #4d79ff; background: #f5f7ff; }
        .today { border: 2px solid #d88a8a !important; font-weight: bold; }
        
        .mark-container { display: flex; gap: 2px; margin-top: 2px; }
        .mark-any { width: 6px; height: 6px; background: #d88a8a; border-radius: 50%; }

        #editor-area { margin-top: 20px; width: 95%; max-width: 400px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); box-sizing: border-box;}
        label { font-size: 12px; color: #888; display: block; margin-bottom: 5px; }
        select, textarea { width: 100%; border-radius: 8px; border: 1px solid #ddd; padding: 10px; box-sizing: border-box; font-size: 16px; margin-bottom: 15px; }
        textarea { height: 80px; resize: none; }
        .save-btn { background: #d88a8a; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; }

        .section-title { width: 95%; max-width: 400px; color: #d88a8a; margin-top: 30px; }
        .filter-group { display: flex; gap: 10px; width: 95%; max-width: 400px; margin-bottom: 10px; }
        .filter-group select { margin-bottom: 0; font-size: 14px; border-color: #d88a8a; }

        .list-container { width: 95%; max-width: 400px; }
        .history-item { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); border-left: 5px solid #d88a8a; position: relative; }
        .history-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 8px; padding-right: 30px; }
        .history-date { font-weight: bold; font-size: 13px; color: #d88a8a; }
        .history-event { color: #ff9f43; font-size: 12px; font-weight: bold; }
        .history-content { font-size: 15px; white-space: pre-wrap; }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #ccc; cursor: pointer; font-size: 18px; line-height: 1; }
    </style>
</head>
<body>

    <div class="calendar-header">
        <button class="nav-btn" onclick="changeMonth(-1)">â—€</button>
        <h2 id="currentMonthYear"></h2>
        <button class="nav-btn" onclick="changeMonth(1)">â–¶</button>
    </div>

    <div id="calendar"></div>

    <div id="editor-area">
        <h3 id="selected-date-label" style="margin-top:0; font-size: 18px;">æ—¥ä»˜ã‚’é¸æŠ</h3>
        <label>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¨®åˆ¥</label>
        <select id="event-input">
            <option value="">ãªã—</option>
            <option value="è©¦åˆæ—¥">âš½ è©¦åˆæ—¥</option>
            <option value="ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°">ğŸ‘‚ ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°</option>
            <option value="å­¦æ ¡è¨ªå•">ğŸ« å­¦æ ¡è¨ªå•</option>
        </select>
        <label>ä»Šæ—¥ã®æ°—åˆ†</label>
        <select id="category-input"><option value="">ãªã—</option><option value="ğŸ˜Š å–œ">ğŸ˜Š å–œ</option><option value="ğŸ‰ æ¥½">ğŸ‰ æ¥½</option><option value="ğŸ˜¢ å“€">ğŸ˜¢ å“€</option><option value="ğŸ’¢ æ€’">ğŸ’¢ æ€’</option></select>
        <label>å†…å®¹</label>
        <textarea id="diary-input" placeholder="å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
        <button class="save-btn" onclick="saveData()">è¨˜éŒ²ã‚’ä¿å­˜ã™ã‚‹</button>
    </div>

    <div class="section-title"><h3>ğŸ” æŒ¯ã‚Šè¿”ã‚ŠæŠ½å‡º</h3></div>
    <div class="filter-group">
        <select id="filter-event" onchange="renderView()"><option value="all">ã™ã¹ã¦ã®äºˆå®š</option><option value="è©¦åˆæ—¥">âš½ è©¦åˆæ—¥ã®ã¿</option><option value="ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°">ğŸ‘‚ ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã®ã¿</option><option value="å­¦æ ¡è¨ªå•">ğŸ« å­¦æ ¡è¨ªå•ã®ã¿</option></select>
        <select id="filter-mood" onchange="renderView()"><option value="all">ã™ã¹ã¦ã®æ°—åˆ†</option><option value="ğŸ˜Š å–œ">ğŸ˜Š å–œã®ã¿</option><option value="ğŸ‰ æ¥½">ğŸ‰ æ¥½ã®ã¿</option><option value="ğŸ˜¢ å“€">ğŸ˜¢ å“€ã®ã¿</option><option value="ğŸ’¢ æ€’">ğŸ’¢ æ€’ã®ã¿</option></select>
    </div>
    <div id="history-list" class="list-container"></div>

    <script>
        let currentViewDate = new Date(); // è¡¨ç¤ºä¸­ã®æœˆã®åŸºæº–
        let selectedDateStr = ""; // "2026-02-21" å½¢å¼
        
        // 2026å¹´ã®ç¥æ—¥ãƒªã‚¹ãƒˆ
        const holidays2026 = {
            "01-01":"å…ƒæ—¥", "01-12":"æˆäººã®æ—¥", "02-11":"å»ºå›½è¨˜å¿µã®æ—¥", "02-23":"å¤©çš‡èª•ç”Ÿæ—¥", "03-20":"æ˜¥åˆ†ã®æ—¥", "04-29":"æ˜­å’Œã®æ—¥",
            "05-03":"æ†²æ³•è¨˜å¿µæ—¥", "05-04":"ã¿ã©ã‚Šã®æ—¥", "05-05":"ã“ã©ã‚‚ã®æ—¥", "05-06":"æŒ¯æ›¿ä¼‘æ—¥", "07-20":"æµ·ã®æ—¥", "08-11":"å±±ã®æ—¥",
            "09-21":"æ•¬è€ã®æ—¥", "09-22":"å›½æ°‘ã®ä¼‘æ—¥", "09-23":"ç§‹åˆ†ã®æ—¥", "10-12":"ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥", "11-03":"æ–‡åŒ–ã®æ—¥", "11-23":"å‹¤åŠ´æ„Ÿè¬ã®æ—¥"
        };

        function renderView() {
            const calendarEl = document.getElementById('calendar');
            const historyListEl = document.getElementById('history-list');
            const year = currentViewDate.getFullYear();
            const month = currentViewDate.getMonth(); // 0-11
            
            document.getElementById('currentMonthYear').innerText = `${year}å¹´ ${month + 1}æœˆ`;
            
            calendarEl.innerHTML = '<div class="weekday sun">æ—¥</div><div class="weekday">æœˆ</div><div class="weekday">ç«</div><div class="weekday">æ°´</div><div class="weekday">æœ¨</div><div class="weekday">é‡‘</div><div class="weekday sat">åœŸ</div>';
            historyListEl.innerHTML = '';
            
            const firstDay = new Date(year, month, 1).getDay(); // 1æ—¥ã®æ›œæ—¥
            const lastDate = new Date(year, month + 1, 0).getDate(); // æœˆã®æœ«æ—¥
            
            // 1æ—¥ã¾ã§ã®ç©ºç™½
            for (let i = 0; i < firstDay; i++) {
                calendarEl.innerHTML += '<div></div>';
            }

            let allMonthlyItems = [];

            for (let d = 1; d <= lastDate; d++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day';
                dayDiv.innerText = d;

                // æ›œæ—¥/ç¥æ—¥åˆ¤å®š
                const dayOfWeek = new Date(year, month, d).getDay();
                if (dayOfWeek === 0) dayDiv.classList.add('sun');
                if (dayOfWeek === 6) dayDiv.classList.add('sat');
                if (year === 2026 && holidays2026[dateStr.slice(5)]) dayDiv.classList.add('holiday');
                
                // ä»Šæ—¥ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                const today = new Date();
                if (year === today.getFullYear() && month === today.getMonth() && d === today.getDate()) dayDiv.classList.add('today');

                // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
                const saved = localStorage.getItem('data-' + dateStr);
                if (saved) {
                    const items = JSON.parse(saved);
                    if (items.length > 0) {
                        dayDiv.innerHTML += '<div class="mark-container"><div class="mark-any"></div></div>';
                        items.forEach((item, idx) => allMonthlyItems.push({ date: dateStr, index: idx, ...item }));
                    }
                }

                dayDiv.onclick = () => {
                    selectedDateStr = dateStr;
                    document.getElementById('selected-date-label').innerText = `${month + 1}æœˆ ${d}æ—¥ã®è¨˜éŒ²ã‚’è¿½åŠ `;
                    document.getElementById('diary-input').value = '';
                };
                calendarEl.appendChild(dayDiv);
            }

            // å±¥æ­´ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆè¡¨ç¤ºä¸­ã®æœˆã®ã¿ã€æ–°ã—ã„é †ï¼‰
            const fEvent = document.getElementById('filter-event').value;
            const fMood = document.getElementById('filter-mood').value;
            
            allMonthlyItems.sort((a, b) => b.date.localeCompare(a.date));
            allMonthlyItems.forEach(item => {
                if ((fEvent === 'all' || item.event === fEvent) && (fMood === 'all' || item.category === fMood)) {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `<button class="delete-btn" onclick="deleteItem('${item.date}', ${item.index})">Ã—</button>
                        <div class="history-header"><span class="history-date">${item.date} ${item.category}</span><span class="history-event">${item.event ? 'ã€'+item.event+'ã€‘' : ''}</span></div>
                        <div class="history-content">${item.text}</div>`;
                    historyListEl.appendChild(div);
                }
            });
        }

        function changeMonth(diff) {
            currentViewDate.setMonth(currentViewDate.getMonth() + diff);
            renderView();
        }

        function saveData() {
            if (!selectedDateStr) return alert('æ—¥ä»˜ã‚’é¸ã‚“ã§ã­');
            const newItem = { category: document.getElementById('category-input').value, event: document.getElementById('event-input').value, text: document.getElementById('diary-input').value };
            const existing = localStorage.getItem('data-' + selectedDateStr);
            const items = existing ? JSON.parse(existing) : [];
            items.push(newItem);
            localStorage.setItem('data-' + selectedDateStr, JSON.stringify(items));
            renderView();
            alert('ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        function deleteItem(date, index) {
            if (!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            const items = JSON.parse(localStorage.getItem('data-' + date));
            items.splice(index, 1);
            if (items.length === 0) localStorage.removeItem('data-' + date);
            else localStorage.setItem('data-' + date, JSON.stringify(items));
            renderView();
        }

        renderView();
    </script>
</body>
</html>
